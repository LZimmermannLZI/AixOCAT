# Demo CI workflow with TcUnit-Runner
name: VM TcUnit-Runner
 
on:
  push:
    branches: [ develop ]
  pull_request:
    branches: [ develop ]
 
jobs:
 
  tcunit_runner:
  
    # a self hosted runner, i.e. VM with tag 'tcunit'
    runs-on: [ self-hosted, VM ]
 
    steps:
 
      - name: Checkout repository
        uses: actions/checkout@v2
 
      - name: Run TcUnit-Runner
        shell: cmd
        # Start TcUnit-Runner with a timeout of 5 min
        run: '"C:\Program Files (x86)\TcUnit-Runner\LaunchTcUnit.bat" -t UnitTest -a 134.130.166.132.1.1 -U 5'
        
  test_results:
  
     runs-on: [ self-hosted, VM ]
     
     steps:
     
      - name: Setup Python
        uses: actions/setup-python@v4.0.0
        with:
          python-version: '3.10.5'
          
      - name: Find Python Version
        run: CPython --version
        
      - name: Publish Test Results
        uses: EnricoMi/publish-unit-test-result-action/composite@v1
        if: always()
        with:
            files: "**/*.xml"
            
      - name: Publish TcUnit results 
        uses: PublishTestResults@2
        with:
            testResultsFormat: 'JUnit'
            testResultsFiles: '**/TcUnit_xUnit_results.xml'
            
